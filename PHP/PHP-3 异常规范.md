# 「PHP 规范」PHP-3 异常规范

## 1. 异常规范

### 1.1 基本规范

- 异常 **一定不可** 用来做流程控制，条件控制。

- **一定不可** 对大段代码进行try-catch，这是不负责任的表现。try 只应该包含可能会抛出异常的代码。

- catch **应该** 区分异常类型，再做对应的异常处理。

- **一定不可** 捕获了异常而不处理它，如果不想处理它，请将该异常抛给它的调用者。

- 最外层的业务使用者，**必须** 处理异常，将其转化为用户可以理解的内容。

- finally块 **必须** 对资源对象、流对象进行关闭，有异常也要做try-catch。

- 发生异常时，应用对外 **必须** 返回错误码，**一定不可** 返回异常细节。

- 发生异常时，应该内部 **应该** 使用“抛异常”的方式。

### 1.2 处理规范

- 对于客户端输入导致的异常
    - 直接返回错误码给客户端；

- 对于应用内方法调用，或者对数据库，外部服务的调用导致的异常：
    - 不知道如何处理的情况下：不要捕获异常；
    - 想添加业务异常信息的情况下：捕获并抛出信息更丰富的异常；
    - 最外层业务使用者（controller），必须处理异常，将其转化为用户可以理解的内容；

- 服务端应用间调用，或对外部服务的调用发生服务不可达异常时；
    - 在能保证幂等性的前提下，**应该** 进行适当次数的重试；

- 熔断处理


- 降级处理

